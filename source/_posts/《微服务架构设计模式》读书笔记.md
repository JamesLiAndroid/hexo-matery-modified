---
title: 《微服务架构设计模式》读书笔记
top: false
cover: false
toc: true
mathjax: true
date: 2020-02-06 11:11:47
password:
summary:
tags:
categories:
---

# 《微服务架构设计模式》读书笔记

从单体架构到微服务，演化路线和注意事项，如何一步步重构单体架构到微服务架构，包含以下内容：

* 单体地狱
* 服务拆分策略
* 通信模式
* 数据一致性
* 领域驱动设计（DDD）
* 事件溯源
* API组合、CQRS
* 网关和外部请求
* 微服务测试转变
* 到达生产环境之前--安全性、外部化可配置、服务可观测
* 部署模式
* 从单体到微服务的重构

要结合我们当前的开发模式、团队协作模式进行思考，考虑做的好与不好的地方，顺便指出需要补充的知识体系。

## 番外

我始终不赞同直接使用微服务架构模式来开发一个从0开始的软件系统，受限于个人认知和对后端开发的认知，从零开始，就要先去解决有无的问题，我认为此时是可以直接走单体架构的。如果扯到时下很火的中台概念，系统是基于中台的基础设施进行开发，那无可厚非，有业务积累和沉淀，自然可借鉴可拆分的内容就更多了。

我们现在从零开始开发，只有跨语言的技术积累，以及业务逻辑的积累，但并不是同一技术栈的实现方式，自然转换时会存在偏差。我个人坚持先实现业务功能，而不是立刻去做微服务的开发，当能够满足需求后再考虑架构演进，考虑周边设施。

如果一定要去实践运行，我的思考是，前期在人员不足、资源不足的情况下，优先考虑把微服务做大，先去划分较大功能范围且有明确边界的微服务，颗粒度要大，但是边界要清晰。然后由此进行开发，尽量维持三人一个微服务的维护团队，尽量让所有人均能承担前端和后端的开发任务！

## 单体地狱

存在问题->解决方式：微服务架构->微服务架构的好坏->描述模式->流程和组织如何变更

1. 不是银弹

2. 对微服务架构的认知普及，统一团队思想，确定演进路线。但是要注意团队变小后，团队内部如何进行自治，如何变被动为主动。

3. DevOps理念的引入，CI\CD外加自动部署

4. 运维保障的规划，可观测、可衡量、可追溯

5. 架构模式和模式描述语言

## 服务拆分策略

架构->如何定义

1. 非功能性因素：可维护、可测试、可部署、可扩展

2. 分层与六边形架构描述

3. 如何定义：定义系统操作、定义服务、定义服务API和协作方式。

**补充内容：**这里需要补充面向对象设计和UML描述的相关知识

4. 分解模式：业务能力、领域驱动DDD

**补充内容：**这里需要补充领域驱动设计（DDD）的相关知识，补充分布式架构的相关知识

## 进程间通信

进程间通信->通信方式(REST、gRPC、消息队列)->异步消息提高可用性

1. 交互方式：一对一、一对多、同步、异步

一对一：请求/响应、异步请求/响应、单向通知
一对多：发布/订阅、发布/异步响应

2. API演化：语义化版本及其兼容策略、消息格式确定（文本、二进制）

3. 同步远程过程调用模式：REST模式、gRPC模式、断路器、服务注册和发现

4. 异步消息模式：消息队列、发布订阅、消息代理、并发和重复消息处理、事务性消息处理

**补充内容：**这里需要补充消息队列的相关知识

## Saga事务模型

微服务事务管理->Saga模型设计（协同式、编排式）->解决隔离问题->设计案例

1. 事务管理：数据一致性、补偿事务回滚操作

2. 协调模式：协同式、编排式。基于消息队列的协调机制、ACD事务模型带来的隔离性问题。

3. 解决隔离问题：ACD缺乏I、丢失更新、脏读、模糊或不可重复读

对策：语义锁、交换式更新、悲观视图、重读值、版本文件、业务风险评级

## 业务逻辑设计


