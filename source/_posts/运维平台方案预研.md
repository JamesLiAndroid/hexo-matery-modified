---
title: 运维平台方案预研
top: false
cover: false
toc: true
mathjax: true
date: 2020-01-05 21:18:29
password:
summary:
tags: DevOps
categories: DevOps
---

# 关于运维平台搭建方案

## 前言

根据目前微服务平台的需求，主要是针对DevOps的迫切需求，结合目前的CI/CD平台，引入新的运维平台，来统一进行微服务以及服务器的运维工作。

## 当前情况

* 已有CI/CD平台
* 缺少统一的日志管理平台，未利用ELK进行搭建
* 针对公有云、私有云、混合云的管理，目前没有合适的工具
* 运维流程没有进行建设，未制定运维规则
* 未针对服务器以及容器，添加运维告警的内容
* 需要以产品思维面向运维内容

## 需求列表及其说明

* 用户管理和权限管理

结合平台目前已有的内容进行实现，开发和运维相关人员不做区分，实践DevOps理念。服务器访问的权限控制，例如验证码的引入。

* 工作流程以及自定义表单信息

结合平台目前已有的内容进行实现，主要体现在工单信息提交，问题提交处理信息。

* 资产管理--CMDB

对接各类公有云平台，例如阿里云、腾讯云、华为云等；针对私有云平台，执行动态扩容缩容，增删机器设备等操作。

* 任务管理和任务调度，定时执行

定时的任务执行平台，对定时任务的管理，对定时任务执行的管理，对其执行结果的管理。

* CI/CD接入，持续集成

针对持续集成平台的管理，接入jenkins体系。对构建的管理，对构建结果的管理，根据构建返回的信息，定位错误并报警

* 数据管理，SQL执行管理

数据库资源的管理，例如MySQL、postgresql、MongoDB、Redis。针对SQL部分，慢SQL查询，SQL执行审计。

* 工单系统

常见资源申请工单提交，测试提交流程，需求/bug的修复流程以及修复确认。

* 文件管理

整个文件上传的集群构建，大文件管理，文件分发到各个服务器。

* 知识库信息

团队知识管理，知识积累，形成技术周报并分发到每个开发人员。

* 监控系统

针对服务器的监控，针对docker镜像的监控运维，容错和避免单点故障，平台预警。针对各类数据库、缓存、消息队列等进行监控。

* 堡垒机，WebShell，操作审计

提供内外网交互的渠道，直接在线输入命令信息，针对各个服务器的操作，进行审计。

* 配置管理

例如Nginx配置管理和下发，Redis的配置管理和下发，多用于支持配置信息的组件。区别于微服务的配置中心，这里配置管理不对微服务镜像配置。

* 镜像管理，应用管理

利用k8s集群，管理镜像信息。

* 微服务基础平台信息

配置中心、注册中心、全链路监控信息，针对目前的痛点而言，要配置在线的参数传入。

* 安全审计

系统安全、混沌工程、接口安全监控、非法调用等信息

* API制定

对外提供API的调用

## 风险点

1. 依托开源项目进行开发，优先引入各模块管理页面信息。
2. 需求需要进行边界梳理。
3. 可能会出现跨语言的情况，例如使用Python或者Rust进行开发，尽量寻找java相关的平台。


## 开源平台

1. 针对k8s管理，使用[kubesphere](https://kubesphere.com.cn/)
2. 针对运维平台，可参考的项目如下：

    * 蓝鲸智云 https://github.com/Tencent/bk-bcs-saas
    * Rainbond https://www.rainbond.com/
    * 猪齿鱼 http://choerodon.io/zh/
    * CoDo  www.opendevops.cn
    * Hygieia https://github.com/Hygieia/Hygieia
    * 女娲 http://nvwa-io.com/
    * adminset https://github.com/guohongze/adminset
    * super-devops https://github.com/wl4g/super-devops
    * devops-x https://github.com/unixhot/devops-x

## 总结

针对微服务的后续开发，应提升运维保障的高度，因为服务分拆之后，对比之前单机的运维方式，需要更深层次的运维管理，不仅是水平扩展的问题，在垂直层面进行微服务的拆分和部署的时候，更需要运维层面进行保障。

## 参考文档

* https://juejin.im/entry/5b568dc4e51d451964625b8c
* https://mp.weixin.qq.com/s?__biz=MzU5MDY1MzcyOQ==&mid=2247483682&idx=1&sn=aa393af4a869db5ec402da4722cf681f&scene=21#wechat_redirect
* https://mp.weixin.qq.com/s/HwOi-ARTvvNjGTWrDmZIkQ
* https://github.com/Hygieia/Hygieia
* https://blog.csdn.net/wowotuo/article/details/79293323
* https://www.cosmoplat.com/pc/community/topicDetail?id=2304922